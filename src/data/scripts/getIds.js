const fs = require('fs');

const text = fs.readFileSync('../ca2010.pl/cageo2010.csv', 'utf-8');

const output = [];

const geoids = [
  '060830029225010',
  '060830029244006',
  '060830029243001',
  '060830029224031',
  '060830029225009',
  '060830029281010',
  '060830029281018',
  '060830029241002',
  '060830029281011',
  '060830029244003',
  '060830029224028',
  '060830029224025',
  '060830029281001',
  '060830029305008',
  '060830029221008',
  '060830029224019',
  '060830029224020',
  '060830029224018',
  '060830029305004',
  '060830029305007',
  '060830029281004',
  '060830029151010',
  '060830029222000',
  '060830029262000',
  '060830029281015',
  '060830029281016',
  '060830029262003',
  '060830029242010',
  '060830029305005',
  '060830029223001',
  '060830029225007',
  '060830029244004',
  '060830029242000',
  '060830029241000',
  '060830029241003',
  '060830029151003',
  '060830029306003',
  '060830029221000',
  '060830029244007',
  '060830029243004',
  '060830029242002',
  '060830029242001',
  '060830029243000',
  '060830029224029',
  '060830029225003',
  '060830029281008',
  '060830029221002',
  '060830029151005',
  '060830029224017',
  '060830029151002',
  '060830029282000',
  '060830029305001',
  '060830029221007',
  '060830029305009',
  '060830029221006',
  '060830029225004',
  '060830029225001',
  '060830029281017',
  '060830029243003',
  '060830029225006',
  '060830029225005',
  '060830029243002',
  '060830029242011',
  '060830029242006',
  '060830029281002',
  '060830029305010',
  '060830029151001',
  '060830029151000',
  '060830029225000',
  '060830029151007',
  '060830029281012',
  '060830029262002',
  '060830029281014',
  '060830029244008',
  '060830029244001',
  '060830029242009',
  '060830029224024',
  '060830029225008',
  '060830029244005',
  '060830029242004',
  '060830029243005',
  '060830029242008',
  '060830029242007',
  '060830029305003',
  '060830029305002',
  '060830029151004',
  '060830029242005',
  '060830029262004',
  '060830029221005',
  '060830029281019',
  '060830029221004',
  '060830029151008',
  '060830029262001',
  '060830029224030',
  '060830029224026',
  '060830029281000',
  '060830029282001',
  '060830029281005',
  '060830029281007',
  '060830029281009',
  '060830029281013',
  '060830029261001',
  '060830029261000',
  '060830029241001',
  '060830029151012',
  '060830029305006',
  '060830029151009',
  '060830029225002',
  '060830029281006',
  '060830029263000',
  '060830029244002',
  '060830029242003',
  '060830029221001',
  '060830029244000',
  '060830029224027',
  '060830029151011',
  '060830029221003',
  '060830029305011',
];

text.split('\n').forEach((d, i) => {
  const sumlev = d.slice(8, 11);

  //   if (+sumlev !== 150) {
  //     return;
  //   }

  const county = d.slice(29, 29 + 3);

  if (county !== '083') {
    return;
  }

  const logrecno = d.slice(18, 18 + 7);
  const tract = d.slice(54, 54 + 6);

  //   console.log(i, `${d.slice(29, 70)}.`);
  const blockgroup = d[60];
  const block = d.slice(61, 61 + 4);

  const geoid = `06${county}${tract}${block}`;

  const pop100 = d.slice(318, 318 + 9);
  const hu100 = d.slice(327, 327 + 9);

  if (!+tract && !+block && !+blockgroup && +geoid === 6083) {
    console.log('COUNTY LOGREC', logrecno, geoid);
  }

  //   console.log(geoid, `.${blockgroup}.`, `.${block}.`);
  if (!geoids.includes(geoid)) {
    return;
  }

  output.push({
    sumlev,
    county,
    logrecno,
    tract,
    block,
    blockgroup,
    geoid,
    pop100,
    hu100,
  });
});

// console.log(output, output.length, [...new Set(geoids)].length);

const logrecnos = output.map((d) => +d.logrecno);

// copy into r dataframe
// console.log(`c(${logrecnos.join(',')})`);
// console.log(`c('${output.map((d) => d.geoid).join("','")}')`);
// console.log(
//   output.map((d) => ({ hu: d.hu100, pop: d.pop100, geoid: d.geoid })),
// );
